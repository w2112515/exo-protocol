{
    "task_id": "P3B-VISUALIZATION",
    "title": "Phase 3-B: 数据可视化组件",
    "priority": "HIGH",
    "status": "READY_TO_DISPATCH",
    "created": "2024-12-15T03:03:00+08:00",
    "design_ref": "P3-FRONTEND-DESIGN.md v2.0 (ADR-011) Section 6.1 + 9",
    "style": "Terminal Minimalism - Living Data Feed",
    "prerequisite": "P3A-FOUNDATION",
    "external_dependencies": [
        {
            "resource": "Mock Data (Local)",
            "type": "数据文件",
            "status": "✅ 已确认",
            "path": "sre-runtime/mock/mock_orders.json + mock_skills.json"
        }
    ],
    "note": "无外部 API 依赖，使用本地 Mock 数据",
    "subtasks": [
        {
            "id": "P3B-01",
            "title": "Mock 数据层注入 (Data Layer Setup)",
            "type": "Logic",
            "input": {
                "mock_orders": "sre-runtime/mock/mock_orders.json (15 orders)",
                "mock_skills": "sre-runtime/mock/mock_skills.json (8 skills)",
                "design_spec": "P3-FRONTEND-DESIGN.md Section 8.1-8.2"
            },
            "output": {
                "files": [
                    "exo-frontend/lib/mock-data.ts (类型定义 + JSON import)",
                    "exo-frontend/lib/api.ts (数据获取函数)",
                    "exo-frontend/hooks/use-orders.ts (TanStack Query hooks)",
                    "exo-frontend/hooks/use-skills.ts (TanStack Query hooks)"
                ]
            },
            "action": [
                "1. 定义 Order 和 Skill TypeScript 接口",
                "2. 将 mock JSON 复制到 exo-frontend/public/mock/ 目录",
                "3. 创建 fetchOrders() 和 fetchSkills() 异步函数",
                "4. 创建 useOrders() 和 useSkills() hooks (TanStack Query)",
                "5. 配置 QueryClientProvider 在 layout.tsx"
            ],
            "acceptance_criteria": [
                "AC-01: Order/Skill 接口与 JSON 字段完全匹配",
                "AC-02: useOrders() 返回 15 条订单数据",
                "AC-03: useSkills() 返回 8 条技能数据",
                "AC-04: 支持 isLoading/isError 状态"
            ],
            "verify": {
                "unit": "在 Dashboard 页面 console.log 验证数据加载",
                "evidence": "浏览器 DevTools 控制台截图显示数据"
            }
        },
        {
            "id": "P3B-02",
            "title": "TerminalFeed 终端日志组件",
            "type": "UI",
            "input": {
                "design_spec": "P3-FRONTEND-DESIGN.md Section 6.1 Live Transactions",
                "data_source": "useOrders() hook",
                "style": {
                    "font": "JetBrains Mono",
                    "highlight": {
                        "order_id": "cyan-400",
                        "status_completed": "success (#14F195)",
                        "status_failed": "red-500",
                        "status_timeout": "yellow-500"
                    },
                    "animation": "扫描线 (Scan Line) 新数据入场效果"
                }
            },
            "output": {
                "files": [
                    "exo-frontend/components/dashboard/terminal-feed.tsx"
                ]
            },
            "action": [
                "1. 创建 TerminalFeed 组件，接收 orders 数据",
                "2. 渲染终端风格日志列表 (时间 | OrderID | Status)",
                "3. 实现状态着色 (completed=绿, failed=红, timeout=黄)",
                "4. 添加扫描线动画 (CSS @keyframes scan-line)",
                "5. 底部淡出效果 (mask-image gradient)",
                "6. 使用 Framer Motion AnimatePresence 处理新数据入场"
            ],
            "acceptance_criteria": [
                "AC-01: 使用 JetBrains Mono 字体",
                "AC-02: OrderID 显示为 cyan-400 颜色",
                "AC-03: Status 根据值着色 (completed/failed/timeout)",
                "AC-04: 新数据出现时有扫描线动画",
                "AC-05: 列表底部有淡出遮罩效果"
            ],
            "verify": {
                "unit": "检查终端样式和颜色",
                "integration": "模拟添加新数据验证动画效果",
                "evidence": "组件截图 + 动画 GIF/录屏"
            }
        },
        {
            "id": "P3B-03",
            "title": "AgentFlowGraph 节点图组件 (React Flow)",
            "type": "UI",
            "input": {
                "design_spec": "P3-FRONTEND-DESIGN.md Section 6.1 Agent Flow",
                "library": "reactflow v11",
                "nodes": [
                    "User",
                    "Protocol",
                    "Executor (Agent)",
                    "Creator"
                ],
                "flow": "User → Protocol → Executor (85%) / Creator (10%) / Protocol Fee (5%)",
                "constraints": {
                    "zoomOnScroll": false,
                    "panOnDrag": false,
                    "nodesDraggable": false,
                    "fitView": true
                }
            },
            "output": {
                "files": [
                    "exo-frontend/components/dashboard/agent-flow-graph.tsx",
                    "exo-frontend/components/dashboard/flow-nodes.tsx (自定义节点)"
                ]
            },
            "action": [
                "1. 创建 AgentFlowGraph 组件",
                "2. 定义 4 个节点: User (左), Protocol (中), Executor/Creator (右)",
                "3. 定义 Edges: User→Protocol, Protocol→Executor, Protocol→Creator, Protocol→ProtocolFee",
                "4. 创建自定义节点样式 (GlassCard + 图标)",
                "5. 锁定交互: 禁用 zoom/pan/drag",
                "6. Edge 样式: 动画虚线 (animated markerEnd)",
                "7. 可选: 简单粒子动画 (CSS animation 模拟)"
            ],
            "acceptance_criteria": [
                "AC-01: 渲染 4 个节点 (User/Protocol/Executor/Creator)",
                "AC-02: Edges 正确连接节点",
                "AC-03: 禁用 zoom/pan/drag (fitView only)",
                "AC-04: Edge 有动画效果 (animated)",
                "AC-05: 节点使用 GlassCard 风格"
            ],
            "verify": {
                "unit": "访问 Dashboard 验证 React Flow 渲染",
                "evidence": "组件截图显示节点和边"
            }
        },
        {
            "id": "P3B-04",
            "title": "KPI Cards 数字动画组件",
            "type": "UI",
            "input": {
                "design_spec": "P3-FRONTEND-DESIGN.md Section 6.1 KPI Cards + 8.2 Number Ticker",
                "metrics": [
                    {
                        "label": "Total Volume",
                        "value": "计算 orders 总价值 (SOL)",
                        "format": "X,XXX.XX SOL"
                    },
                    {
                        "label": "Active Skills",
                        "value": "skills.length",
                        "format": "N"
                    },
                    {
                        "label": "Avg Latency",
                        "value": "计算 orders 平均 execution_time_ms",
                        "format": "XXXms"
                    }
                ],
                "animation": "Number Ticker (数字滚动效果)"
            },
            "output": {
                "files": [
                    "exo-frontend/components/dashboard/kpi-card.tsx",
                    "exo-frontend/components/ui/number-ticker.tsx"
                ]
            },
            "action": [
                "1. 创建 NumberTicker 组件 (Framer Motion useSpring)",
                "2. 创建 KPICard 组件 (GlassCard + NumberTicker)",
                "3. 实现数字滚动动画 (tabular-nums font-feature)",
                "4. 计算真实 KPI 值 (from mock data)",
                "5. 在 Dashboard 替换静态 KPI"
            ],
            "acceptance_criteria": [
                "AC-01: NumberTicker 显示数字变化动画",
                "AC-02: Total Volume 从 mock 数据计算 (sum price_lamports / 1e9)",
                "AC-03: Avg Latency 从 mock 数据计算 (avg execution_time_ms)",
                "AC-04: 使用 tabular-nums 防止数字宽度抖动"
            ],
            "verify": {
                "unit": "更改数据源验证数字滚动效果",
                "evidence": "KPI Cards 截图 + 数字滚动 GIF"
            }
        },
        {
            "id": "P3B-05",
            "title": "Dashboard 集成与验证",
            "type": "Integration",
            "input": {
                "components": [
                    "TerminalFeed",
                    "AgentFlowGraph",
                    "KPICard"
                ],
                "page": "exo-frontend/app/dashboard/page.tsx"
            },
            "output": {
                "files": [
                    "exo-frontend/app/dashboard/page.tsx (更新)"
                ]
            },
            "action": [
                "1. 在 Dashboard 页面集成 TerminalFeed 组件",
                "2. 在 Dashboard 页面集成 AgentFlowGraph 组件",
                "3. 替换静态 KPI 为 KPICard 组件",
                "4. 验证布局响应式 (Desktop/Mobile)",
                "5. 运行 pnpm build 确保无 TS 错误"
            ],
            "acceptance_criteria": [
                "AC-01: Dashboard 显示真实 Mock 数据",
                "AC-02: TerminalFeed 渲染 15 条订单",
                "AC-03: AgentFlowGraph 渲染 4 节点图",
                "AC-04: KPI Cards 显示计算值",
                "AC-05: pnpm build 无错误"
            ],
            "verify": {
                "unit": "pnpm dev 访问 localhost:3000/dashboard",
                "integration": "pnpm build 检查构建",
                "evidence": "全屏 Dashboard 截图 (Desktop 1920x1080)"
            }
        }
    ],
    "execution_order": [
        "P3B-01",
        "P3B-02",
        "P3B-03",
        "P3B-04",
        "P3B-05"
    ],
    "parallel_allowed": false,
    "estimated_time": "3-4 hours",
    "note_to_wap": [
        "严格按顺序执行。P3B-01 是数据基础，必须先完成。",
        "P3B-02 TerminalFeed 扫描线动画使用 CSS @keyframes，不要用 JS setInterval。",
        "P3B-03 React Flow 必须锁定视图 (zoomOnScroll=false 等)，这是设计要求。",
        "P3B-04 NumberTicker 使用 Framer Motion useSpring，不要用 setInterval 计数。",
        "所有组件必须使用设计系统颜色 (--color-primary, --color-success)。"
    ]
}