{
  "task_id": "Task-07",
  "title": "exo-hooks Bankrun 单元测试",
  "priority": "HIGH",
  "status": "DISPATCHED",
  "dispatched_at": "2024-12-14T22:15:00+08:00",
  "description": "使用 Bankrun (solana-bankrun) 框架为 exo-hooks 合约编写单元测试，验证 Transfer Hook 核心逻辑",
  "rationale": "Task-06B 已完成 IDL 和 TypeScript 类型，现可进行链下模拟测试验证合约逻辑正确性",
  "input": {
    "program_so": "anchor/target/deploy/exo_hooks.so",
    "idl": "anchor/target/idl/exo_hooks.json",
    "types": "anchor/target/types/exo_hooks.ts",
    "reference_docs": [
      "docs/SKILL_SCHEMA.md",
      "docs/AGENT_STANDARD.md"
    ]
  },
  "output": {
    "test_file": "anchor/tests/exo-hooks.test.ts",
    "report": ".project_state/reports/Task-07_report.json"
  },
  "acceptance_criteria": [
    {
      "id": "AC-01",
      "description": "initializeHook 测试：创建 HookConfig PDA，验证费率配置存储",
      "type": "Unit"
    },
    {
      "id": "AC-02", 
      "description": "initializeExtraAccountMetaList 测试：创建 ExtraAccountMetas PDA",
      "type": "Unit"
    },
    {
      "id": "AC-03",
      "description": "transferHook 测试：模拟转账触发，验证 Hook 执行",
      "type": "Unit"
    },
    {
      "id": "AC-04",
      "description": "updateHookConfig 测试：权限验证 + 费率更新",
      "type": "Unit"
    },
    {
      "id": "AC-05",
      "description": "错误场景测试：Unauthorized / InvalidFeeConfig",
      "type": "Unit"
    }
  ],
  "verify": {
    "command": "cd anchor && npx vitest run tests/exo-hooks.test.ts --reporter=json",
    "success_criteria": "exit_code: 0, all tests pass"
  },
  "external_dependencies": {
    "type": "none",
    "note": "Bankrun 使用本地模拟 SVM，无需外部网络"
  },
  "constraints": [
    "使用 solana-bankrun 或 anchor-bankrun 框架",
    "测试文件使用 TypeScript",
    "导入 Task-06B 生成的类型定义",
    "每个指令至少一个正向测试 + 一个负向测试"
  ],
  "estimated_steps": 6,
  "timeout_minutes": 45
}
